#ifndef MENUMAKER_H_
#define MENUMAKER_H_

#include "Arduino.h"
#include "LinkedList.h"
#include "string.h"

class MenuMakerEntry {
public:
	int id;
	const char *title;
	const char *overlay;
	bool submenu;
	MenuMakerEntry(int id, const char *title, bool submenu);
	void setOverlay(const char *text);
	const char* text();
	
};

class MenuMakerMenu {
public:
	MenuMakerMenu(int id, const char* title);
	MenuMakerMenu* addEntry(int id, const char* title, bool submenu);

	int id;
	const char* title;
	LinkedList<MenuMakerEntry*> *entries;
};

class MenuMaker {
public:
	MenuMaker();
	
	void begin();
	
	void redraw();
	void show(int id);
	/**
	 * Call this from your HID
	 **/
	void onUp();
	void onDown();
	void onLeft();
	void onRight();
	void onSelect();
	void onBack();
	/**
	 * Tell the menu stack you want an item highlighted.
	 * Function name is stupid.
	 **/
	void onHighlight(int index);
	
	LinkedList<MenuMakerMenu*> *menus;
	MenuMakerMenu* currentMenu;
	int currentEntry;

protected:
	LinkedList<MenuMakerMenu*> *history;
	/**
	 * Auto-generated by Perl script into MenuMaker_menu.h
	 **/
	void onCreate();
	/**
	 * Implement this for your hardware
	 **/
	virtual void draw(MenuMakerMenu* menu, int highlight = 0) = 0;
	/**
	 * Implement this for your hardware
	 **/
	virtual void highlight(int pos) = 0;
	/**
	 * Implement this to call your functions
	 **/
	virtual void onEntry(int id) = 0;
	
private:
	void select(MenuMakerMenu *menu);
	MenuMakerMenu* createMenu(int id, const char* title);
	MenuMakerMenu* resolveMenu(int id);
	
};

#endif // MENUMAKER_H_